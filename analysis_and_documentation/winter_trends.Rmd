---
title: "Covid Hospital Activity Analysis"
output: html_notebook
---

```{r}
# How does Covid affect hospital activity?
# Was there a change post Q1 2020?
```


```{r, echo=FALSE, message=FALSE, results='hide'}
library(tidyverse)
library(sf)
library(janitor)
library(jsonlite)
library(lubridate)
library(rgdal)
library(broom)
library(readr)
library(here)
library(slider)
```

```{r}
here::here()
```

```{r}
hosp_activity <- read_csv(here("clean_data/df_ha_dep.csv"))
```

```{r}
hosp_activity <- hosp_activity %>% 
  mutate(q_year = str_c(year, " Q",quarter))
```

# Comparing emergency and non-emergency

```{r}
hosp_act <- hosp_activity %>% 
  filter(admission_type %in% c("Emergency Inpatients","All Inpatients and Day cases" ))
```

```{r}
hosp_act %>% 
  ggplot(fill="admission_type") +
    geom_histogram(aes(x = q_year, y = (sum(episodes)/100000), fill = q_year), 
             stat = "identity", alpha = 0.7 ) +
    scale_fill_manual( values = c("2016 Q2","2016 Q3","2016 Q4",
             "2017 Q1"= "steelblue", "2017 Q2","2017 Q3","2017 Q4",
             "2018 Q1"= "steelblue", "2018 Q2","2018 Q3","2018 Q4",             
             "2019 Q1"= "steelblue", "2019 Q2","2019 Q3","2019 Q4",            
             "2020 Q1"= "steelblue", "2020 Q2","2020 Q3","2020 Q4",           
             "2021 Q1"= "steelblue", "2021 Q2" ), 
                guide = FALSE ) +
      theme(axis.text.x = element_text(angle = 45))+
  labs(title = "All Inpatients and Day cases",
       subtitle = "Q1 (Winter) highlighted")+
      xlab("Time (Year/Quarter)")+
      ylab("Admission Count (100,000s)")  +
  theme(        legend.position = "bottom",
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.margin = margin(6, 6, 6, 6),
        legend.text = element_text(colour="slategray", size=8))

    
```